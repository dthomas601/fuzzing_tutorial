# Exercise 1: Search String (libFuzzer)

In this exercise, use the fuzzing tools outlined previously to identify vulnerabilities in the source code provided.

In this portion of the assignment, we will provide different tasks that each student should complete. The answers are provided below, but the goal for the user should be to complete the activities without assistance. Only look at portions of the answers when all other alternatives have been exhausted.


The source code ```string_search.cpp``` and ```checker.h``` will be used for this example. An example run of this program is provided below compiled with the command ```clang++ string_search.cpp```.

```
[afl++ e7b1c6fd0a5d] /src/fuzzing_tutorial/3_Exercises/Exercise_1 (main) # ./a.out
Enter the string that will be searched:
```

**Mary had a little lamb.**

```
Enter the character that is being searched for:
```

**a**

```
Length 23
Search char is 'a'
Checked string: Mary had a little lamb.
Chars count was: 4
```

In this example we will fuzz the functions in ```checker.h```.


## Task 1: Create a fuzzing harness for libFuzzer

Lets now modify the source file so that libFuzzer can be used. The harness structure for libFuzzer requires that we use the function ```extern "C" int LLVMFuzzerTestOneInput(const uint8_t *Data, size_t Size) ```. (
Refer to the example 3_Fuzzing_Tools/libFuzzer)

Another hint, the data to the ```LLVMFuzzerTestOneInput``` function is one input. You can utilize tools such as ```stringstream``` to tokenize the data that is generated by libFuzzer and modify the ```getline``` and ```cin``` portions of ```string_search.cpp``` used previously. The structure of your seed test cases would change to values that are string delimited. A modify example is shown below for an input that is delimited by ```,```.

```
welcome to the real world,w
```

Example usage for stringstream can be found here:
* https://www.geeksforgeeks.org/stringstream-c-applications/
* https://www.tutorialspoint.com/stringstream-in-cplusplus

Now rewrite the ```string_search.cpp``` source code to be used by libFuzzer. Compile the new source file ```string_search_harness.cpp``` and create an executable named ```searcher_libfuzzer```.

<details>

<summary>Solution Task 1 </summary>

The restructured source code can be found in ```string_search_harness.cpp```

To compile use the following command:

```
clang++ -g -O1 -fsanitize=fuzzer -o searcher_libfuzzer string_search_harness.cpp
```

</details>


## Task 2: Execute the libFuzzer binary

Run the libFuzzer binary.

<details>

<summary>Solution Task 2 </summary>

The command is as follows:

```
./searcher_libfuzzer -i in/
```

The resulting crash file will be saved to the current directory. The fuzzing campaign will stop when a crash is detected.

One of the resulting crashes is associated with the function ```validate_data(string)``` in ```checker.h```.

</details>